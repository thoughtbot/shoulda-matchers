<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Shoulda::Matchers::ActiveRecord
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="../../css/solarized.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/bootstrap.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/global.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Shoulda::Matchers::ActiveRecord";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.stickyheaders.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/underscore.min.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div class="header-row">
        <div id="menu">
  
    <span class="title">
      <a href="../../index.html" title="Home">Home</a>
    </span> &raquo;
  
  
    <span class='title'><span class='object_link'><a href="../../Shoulda.html" title="Shoulda (module)">Shoulda</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Matchers.html" title="Shoulda::Matchers (module)">Matchers</a></span></span>
     &raquo; 
    <span class="title">ActiveRecord</span>
  
</div>

        <div id="search" class="js-search">
  <ul>
    
      <li>
        <a href="../../class_list.html">
          Class List
        </a>
      </li>
    
      <li>
        <a href="../../method_list.html">
          Method List
        </a>
      </li>
    
      <li>
        <a href="../../file_list.html">
          File List
        </a>
      </li>
    
  </ul>

  <iframe id="search_frame" class="js-search-frame"></iframe>
</div>

        <div class="clear"></div>
      </div>
    </div>

    <div id="main">
      <div id="content"><h1>Module: Shoulda::Matchers::ActiveRecord
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
</dl>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>This module provides matchers that are used to test behavior within
ActiveRecord classes.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#accept_nested_attributes_for-instance_method" title="#accept_nested_attributes_for (instance method)">#<strong>accept_nested_attributes_for</strong>(name)  &#x21d2; AcceptNestedAttributesForMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>accept_nested_attributes_for</code> matcher tests usage of the <code>accepts_nested_attributes_for</code> macro.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#belong_to-instance_method" title="#belong_to (instance method)">#<strong>belong_to</strong>(name)  &#x21d2; AssociationMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>belong_to</code> matcher is used to ensure that a <code>belong_to</code> association exists on your model.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_enum_for-instance_method" title="#define_enum_for (instance method)">#<strong>define_enum_for</strong>(attribute_name)  &#x21d2; DefineEnumForMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>define_enum_for</code> matcher is used to test that the <code>enum</code> macro has been used to decorate an attribute with enum capabilities.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_and_belong_to_many-instance_method" title="#have_and_belong_to_many (instance method)">#<strong>have_and_belong_to_many</strong>(name)  &#x21d2; AssociationMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_and_belong_to_many</code> matcher is used to test that a <code>has_and_belongs_to_many</code> association exists on your model and that the join table exists in the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_db_column-instance_method" title="#have_db_column (instance method)">#<strong>have_db_column</strong>(column)  &#x21d2; HaveDbColumnMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_db_column</code> matcher tests that the table that backs your model has a specific column.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_db_index-instance_method" title="#have_db_index (instance method)">#<strong>have_db_index</strong>(columns)  &#x21d2; HaveDbIndexMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_db_index</code> matcher tests that the table that backs your model has a specific index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_many-instance_method" title="#have_many (instance method)">#<strong>have_many</strong>(name)  &#x21d2; AssociationMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_many</code> matcher is used to test that a <code>has_many</code> or <code>has_many :through</code> association exists on your model.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_one-instance_method" title="#have_one (instance method)">#<strong>have_one</strong>(name)  &#x21d2; AssociationMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_one</code> matcher is used to test that a <code>has_one</code> or <code>has_one :through</code> association exists on your model.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_readonly_attribute-instance_method" title="#have_readonly_attribute (instance method)">#<strong>have_readonly_attribute</strong>(value)  &#x21d2; HaveReadonlyAttributeMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>have_readonly_attribute</code> matcher tests usage of the <code>attr_readonly</code> macro.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_secure_token-instance_method" title="#have_secure_token (instance method)">#<strong>have_secure_token</strong>(token_attribute = :token)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>rubocop:disable Style/PredicateName.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#serialize-instance_method" title="#serialize (instance method)">#<strong>serialize</strong>(name)  &#x21d2; SerializeMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>serialize</code> matcher tests usage of the <code>serialize</code> macro.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_uniqueness_of-instance_method" title="#validate_uniqueness_of (instance method)">#<strong>validate_uniqueness_of</strong>(attr)  &#x21d2; ValidateUniquenessOfMatcher </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The <code>validate_uniqueness_of</code> matcher tests usage of the <code>validates_uniqueness_of</code> validation.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="accept_nested_attributes_for-instance_method">
  
    #<strong>accept_nested_attributes_for</strong>(name)  &#x21d2; <tt><span class='object_link'>AcceptNestedAttributesForMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>accept_nested_attributes_for</code> matcher tests usage of the
<code>accepts_nested_attributes_for</code> macro.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Car</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:doors</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Car</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:doors</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda) (using Shoulda)</span>
<span class="k">class</span> <span class="nc">CarTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:doors</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>allow_destroy</h5>

<p>Use <code>allow_destroy</code> to assert that the <code>:allow_destroy</code> option was
specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Car</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:mirrors</span><span class="p">,</span> <span class="ss">allow_destroy</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Car</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:mirrors</span><span class="p">)</span><span class="o">.</span>
      <span class="n">allow_destroy</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">CarTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:mirrors</span><span class="p">)</span><span class="o">.</span>
    <span class="n">allow_destroy</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>limit</h5>

<p>Use <code>limit</code> to assert that the <code>:limit</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Car</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:windows</span><span class="p">,</span> <span class="ss">limit</span><span class="p">:</span> <span class="mi">3</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Car</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:windows</span><span class="p">)</span><span class="o">.</span>
      <span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">CarTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:windows</span><span class="p">)</span><span class="o">.</span>
    <span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>update_only</h5>

<p>Use <code>update_only</code> to assert that the <code>:update_only</code> option was
specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Car</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:engine</span><span class="p">,</span> <span class="ss">update_only</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Car</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:engine</span><span class="p">)</span><span class="o">.</span>
      <span class="n">update_only</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">CarTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">accept_nested_attributes_for</span><span class="p">(</span><span class="ss">:engine</span><span class="p">)</span><span class="o">.</span>
    <span class="n">update_only</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


93
94
95</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/accept_nested_attributes_for_matcher.rb', line 93</span>

<span></span><span class="k">def</span> <span class="nf">accept_nested_attributes_for</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">AcceptNestedAttributesForMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="belong_to-instance_method">
  
    #<strong>belong_to</strong>(name)  &#x21d2; <tt><span class='object_link'>AssociationMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>belong_to</code> matcher is used to ensure that a <code>belong_to</code> association
exists on your model.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Note that polymorphic associations are automatically detected and do not
need any qualifiers:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:commentable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Comment</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:commentable</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">CommentTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:commentable</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>conditions</h5>

<p>Use <code>conditions</code> if your association is defined with a scope that sets
the <code>where</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:family</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">everyone_is_perfect</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:family</span><span class="p">)</span><span class="o">.</span>
      <span class="n">conditions</span><span class="p">(</span><span class="ss">everyone_is_perfect</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:family</span><span class="p">)</span><span class="o">.</span>
    <span class="n">conditions</span><span class="p">(</span><span class="ss">everyone_is_perfect</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>order</h5>

<p>Use <code>order</code> if your association is defined with a scope that sets the
<code>order</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:previous_company</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;hired_on desc&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:previous_company</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;hired_on desc&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:previous_company</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;hired_on desc&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>class_name</h5>

<p>Use <code>class_name</code> to test usage of the <code>:class_name</code> option. This
asserts that the model you&#39;re referring to actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:ancient_city</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s1">&#39;City&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:ancient_city</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:ancient_city</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_primary_key</h5>

<p>Use <code>with_primary_key</code> to test usage of the <code>:primary_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:great_country</span><span class="p">,</span> <span class="ss">primary_key</span><span class="p">:</span> <span class="s1">&#39;country_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:great_country</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:great_country</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_foreign_key</h5>

<p>Use <code>with_foreign_key</code> to test usage of the <code>:foreign_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:great_country</span><span class="p">,</span> <span class="ss">foreign_key</span><span class="p">:</span> <span class="s1">&#39;country_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:great_country</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:great_country</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>dependent</h5>

<p>Use <code>dependent</code> to assert that the <code>:dependent</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:world</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:world</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:destroy</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:world</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:destroy</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>To assert that <em>any</em> <code>:dependent</code> option was specified, use <code>true</code>:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:world</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>To assert that <em>no</em> <code>:dependent</code> option was specified, use <code>false</code>:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:company</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:company</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<h5>counter_cache</h5>

<p>Use <code>counter_cache</code> to assert that the <code>:counter_cache</code> option was
specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span><span class="p">,</span> <span class="ss">counter_cache</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">counter_cache</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">counter_cache</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>touch</h5>

<p>Use <code>touch</code> to assert that the <code>:touch</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span><span class="p">,</span> <span class="ss">touch</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>autosave</h5>

<p>Use <code>autosave</code> to assert that the <code>:autosave</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:bank</span><span class="p">,</span> <span class="ss">autosave</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Account</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:bank</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">AccountTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:bank</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>inverse_of</h5>

<p>Use <code>inverse_of</code> to assert that the <code>:inverse_of</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span><span class="p">,</span> <span class="ss">inverse_of</span><span class="p">:</span> <span class="ss">:employees</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Person</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">inverse_of</span><span class="p">(</span><span class="ss">:employees</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">inverse_of</span><span class="p">(</span><span class="ss">:employees</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>required</h5>

<p>Use <code>required</code> to assert that the association is not allowed to be nil.
(Enabled by default in Rails 5+.)</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Person</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">required</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">required</span>
<span class="k">end</span>
</code></pre>

<h5>without_validating_presence</h5>

<p>Use <code>without_validating_presence</code> with <code>belong_to</code> to prevent the
matcher from checking whether the association disallows nil (Rails 5+
only). This can be helpful if you have a custom hook that always sets
the association to a meaningful value:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span>

  <span class="n">before_validation</span> <span class="ss">:autoassign_organization</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">autoassign_organization</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">organization</span> <span class="o">=</span> <span class="no">Organization</span><span class="o">.</span><span class="n">create!</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Person</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">without_validating_presence</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">without_validating_presence</span>
<span class="k">end</span>
</code></pre>

<h5>optional</h5>

<p>Use <code>optional</code> to assert that the association is allowed to be nil.
(Rails 5+ only.)</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span><span class="p">,</span> <span class="ss">optional</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Person</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">belong_to</span><span class="p">(</span><span class="ss">:organization</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


325
326
327</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/association_matcher.rb', line 325</span>

<span></span><span class="k">def</span> <span class="nf">belong_to</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">AssociationMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:belongs_to</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_enum_for-instance_method">
  
    #<strong>define_enum_for</strong>(attribute_name)  &#x21d2; <tt><span class='object_link'>DefineEnumForMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>define_enum_for</code> matcher is used to test that the <code>enum</code> macro has
been used to decorate an attribute with enum capabilities.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Process</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span><span class="ss">:running</span><span class="p">,</span> <span class="ss">:stopped</span><span class="p">,</span> <span class="ss">:suspended</span><span class="o">]</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Process</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProcessTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>with_values</h5>

<p>Use <code>with_values</code> to test that the attribute can only receive a certain
set of possible values.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Process</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span><span class="ss">:running</span><span class="p">,</span> <span class="ss">:stopped</span><span class="p">,</span> <span class="ss">:suspended</span><span class="o">]</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Process</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:running</span><span class="p">,</span> <span class="ss">:stopped</span><span class="p">,</span> <span class="ss">:suspended</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProcessTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:running</span><span class="p">,</span> <span class="ss">:stopped</span><span class="p">,</span> <span class="ss">:suspended</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>If the values backing your enum attribute are arbitrary instead of a
series of integers starting from 0, pass a hash to <code>with_values</code> instead
of an array:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Process</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="p">{</span>
    <span class="ss">running</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="ss">stopped</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="ss">suspended</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="ss">other</span><span class="p">:</span> <span class="mi">99</span>
  <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Process</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_values</span><span class="p">(</span><span class="ss">running</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">stopped</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">suspended</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">other</span><span class="p">:</span> <span class="mi">99</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProcessTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_values</span><span class="p">(</span><span class="ss">running</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">stopped</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">suspended</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">other</span><span class="p">:</span> <span class="mi">99</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>backed_by_column_of_type</h5>

<p>Use <code>backed_by_column_of_type</code> when the column backing your column type
is a string instead of an integer:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">LoanApplication</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="p">{</span>
    <span class="ss">active</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
    <span class="ss">pending</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
    <span class="ss">rejected</span><span class="p">:</span> <span class="s2">&quot;rejected&quot;</span>
  <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">LoanApplication</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_values</span><span class="p">(</span>
        <span class="ss">active</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
        <span class="ss">pending</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
        <span class="ss">rejected</span><span class="p">:</span> <span class="s2">&quot;rejected&quot;</span>
      <span class="p">)</span><span class="o">.</span>
      <span class="n">backed_by_column_of_type</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">LoanApplicationTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_values</span><span class="p">(</span>
      <span class="ss">active</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
      <span class="ss">pending</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
      <span class="ss">rejected</span><span class="p">:</span> <span class="s2">&quot;rejected&quot;</span>
    <span class="p">)</span><span class="o">.</span>
    <span class="n">backed_by_column_of_type</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_prefix</h5>

<p>Use <code>with_prefix</code> to test that the enum is defined with a <code>_prefix</code>
option (Rails 5 only). Can take either a boolean or a symbol:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Issue</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">,</span> <span class="ss">_prefix</span><span class="p">:</span> <span class="ss">:old</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Issue</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_prefix</span><span class="p">(</span><span class="ss">:old</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProcessTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_prefix</span><span class="p">(</span><span class="ss">:old</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_suffix</h5>

<p>Use <code>with_suffix</code> to test that the enum is defined with a <code>_suffix</code>
option (Rails 5 only). Can take either a boolean or a symbol:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Issue</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">,</span> <span class="ss">_suffix</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Issue</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_suffix</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProcessTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">define_enum_for</span><span class="p">(</span><span class="ss">:status</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_values</span><span class="p">(</span><span class="o">[</span><span class="ss">:open</span><span class="p">,</span> <span class="ss">:closed</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_suffix</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


162
163
164</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/define_enum_for_matcher.rb', line 162</span>

<span></span><span class="k">def</span> <span class="nf">define_enum_for</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>
  <span class="no">DefineEnumForMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_and_belong_to_many-instance_method">
  
    #<strong>have_and_belong_to_many</strong>(name)  &#x21d2; <tt><span class='object_link'>AssociationMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_and_belong_to_many</code> matcher is used to test that a
<code>has_and_belongs_to_many</code> association exists on your model and that the
join table exists in the database.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:awards</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:awards</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:awards</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>conditions</h5>

<p>Use <code>conditions</code> if your association is defined with a scope that sets
the <code>where</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:issues</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">difficulty</span><span class="p">:</span> <span class="s1">&#39;hard&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:issues</span><span class="p">)</span><span class="o">.</span>
      <span class="n">conditions</span><span class="p">(</span><span class="ss">difficulty</span><span class="p">:</span> <span class="s1">&#39;hard&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:issues</span><span class="p">)</span><span class="o">.</span>
    <span class="n">conditions</span><span class="p">(</span><span class="ss">difficulty</span><span class="p">:</span> <span class="s1">&#39;hard&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>order</h5>

<p>Use <code>order</code> if your association is defined with a scope that sets the
<code>order</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:projects</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;time_spent&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:projects</span><span class="p">)</span><span class="o">.</span>
      <span class="n">order</span><span class="p">(</span><span class="s1">&#39;time_spent&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:projects</span><span class="p">)</span><span class="o">.</span>
    <span class="n">order</span><span class="p">(</span><span class="s1">&#39;time_spent&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>class_name</h5>

<p>Use <code>class_name</code> to test usage of the <code>:class_name</code> option. This
asserts that the model you&#39;re referring to actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:places_visited</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s1">&#39;City&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:places_visited</span><span class="p">)</span><span class="o">.</span>
      <span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:places_visited</span><span class="p">)</span><span class="o">.</span>
    <span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>join_table</h5>

<p>Use <code>join_table</code> to test usage of the <code>:join_table</code> option. This
asserts that the table you&#39;re referring to actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:issues</span><span class="p">,</span> <span class="ss">join_table</span><span class="p">:</span> <span class="s1">&#39;people_tickets&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:issues</span><span class="p">)</span><span class="o">.</span>
      <span class="n">join_table</span><span class="p">(</span><span class="s1">&#39;people_tickets&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:issues</span><span class="p">)</span><span class="o">.</span>
    <span class="n">join_table</span><span class="p">(</span><span class="s1">&#39;people_tickets&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>validate</h5>

<p>Use <code>validate</code> to test that the <code>:validate</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:interviews</span><span class="p">,</span> <span class="ss">validate</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:interviews</span><span class="p">)</span><span class="o">.</span>
      <span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:interviews</span><span class="p">)</span><span class="o">.</span>
    <span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>autosave</h5>

<p>Use <code>autosave</code> to assert that the <code>:autosave</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Publisher</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_and_belongs_to_many</span> <span class="ss">:advertisers</span><span class="p">,</span> <span class="ss">autosave</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Publisher</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:advertisers</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">AccountTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_and_belong_to_many</span><span class="p">(</span><span class="ss">:advertisers</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


982
983
984</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/association_matcher.rb', line 982</span>

<span></span><span class="k">def</span> <span class="nf">have_and_belong_to_many</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">AssociationMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:has_and_belongs_to_many</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_db_column-instance_method">
  
    #<strong>have_db_column</strong>(column)  &#x21d2; <tt><span class='object_link'>HaveDbColumnMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_db_column</code> matcher tests that the table that backs your model
has a specific column.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePhones</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:phones</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:supported_ios_version</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Phone</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:supported_ios_version</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PhoneTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:supported_ios_version</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>of_type</h5>

<p>Use <code>of_type</code> to assert that a column is defined as a certain type.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePhones</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:phones</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">decimal</span> <span class="ss">:camera_aperture</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Phone</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:camera_aperture</span><span class="p">)</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="ss">:decimal</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PhoneTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:camera_aperture</span><span class="p">)</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="ss">:decimal</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_options</h5>

<p>Use <code>with_options</code> to assert that a column has been defined with
certain options (<code>:precision</code>, <code>:limit</code>, <code>:default</code>, <code>:null</code>, <code>:scale</code>,
or <code>:primary</code>).</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePhones</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:phones</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">decimal</span> <span class="ss">:camera_aperture</span><span class="p">,</span> <span class="ss">precision</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Phone</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:camera_aperture</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_options</span><span class="p">(</span><span class="ss">precision</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PhoneTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_column</span><span class="p">(</span><span class="ss">:camera_aperture</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_options</span><span class="p">(</span><span class="ss">precision</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


81
82
83</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/have_db_column_matcher.rb', line 81</span>

<span></span><span class="k">def</span> <span class="nf">have_db_column</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
  <span class="no">HaveDbColumnMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_db_index-instance_method">
  
    #<strong>have_db_index</strong>(columns)  &#x21d2; <tt><span class='object_link'>HaveDbIndexMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_db_index</code> matcher tests that the table that backs your model
has a specific index.</p>

<p>You can specify one column:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreateBlogs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:blogs</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:user_id</span>
    <span class="k">end</span>

    <span class="n">add_index</span> <span class="ss">:blogs</span><span class="p">,</span> <span class="ss">:user_id</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Blog</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:user_id</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">BlogTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:user_id</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Or you can specify a group of columns:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreateBlogs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:blogs</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:user_id</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
    <span class="k">end</span>

    <span class="n">add_index</span> <span class="ss">:blogs</span><span class="p">,</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Blog</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="o">[</span><span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:name</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">BlogTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="o">[</span><span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:name</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Finally, if you&#39;re using Rails 5 and PostgreSQL, you can also specify an
expression:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreateLoggedErrors</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:logged_errors</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:code</span>
      <span class="n">t</span><span class="o">.</span><span class="n">jsonb</span> <span class="ss">:content</span>
    <span class="k">end</span>

    <span class="n">add_index</span> <span class="ss">:logged_errors</span><span class="p">,</span> <span class="s1">&#39;lower(code)::text&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">LoggedError</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="s1">&#39;lower(code)::text&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">LoggedErrorTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="s1">&#39;lower(code)::text&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>unique</h5>

<p>Use <code>unique</code> to assert that the index is either unique or non-unique:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreateBlogs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:blogs</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:domain</span>
      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:user_id</span>
    <span class="k">end</span>

    <span class="n">add_index</span> <span class="ss">:blogs</span><span class="p">,</span> <span class="ss">:domain</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
    <span class="n">add_index</span> <span class="ss">:blogs</span><span class="p">,</span> <span class="ss">:user_id</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Blog</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>   <span class="c1"># if you want to be explicit</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:user_id</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">BlogTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>   <span class="c1"># if you want to be explicit</span>
  <span class="n">should</span> <span class="n">have_db_index</span><span class="p">(</span><span class="ss">:user_id</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


110
111
112</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/have_db_index_matcher.rb', line 110</span>

<span></span><span class="k">def</span> <span class="nf">have_db_index</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
  <span class="no">HaveDbIndexMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_many-instance_method">
  
    #<strong>have_many</strong>(name)  &#x21d2; <tt><span class='object_link'>AssociationMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_many</code> matcher is used to test that a <code>has_many</code> or <code>has_many
:through</code> association exists on your model.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:friends</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Note that polymorphic associations are automatically detected and do not
need any qualifiers:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:pictures</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:imageable</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:pictures</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:pictures</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>conditions</h5>

<p>Use <code>conditions</code> if your association is defined with a scope that sets
the <code>where</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:coins</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">quality</span><span class="p">:</span> <span class="s1">&#39;mint&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:coins</span><span class="p">)</span><span class="o">.</span><span class="n">conditions</span><span class="p">(</span><span class="ss">quality</span><span class="p">:</span> <span class="s1">&#39;mint&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:coins</span><span class="p">)</span><span class="o">.</span><span class="n">conditions</span><span class="p">(</span><span class="ss">quality</span><span class="p">:</span> <span class="s1">&#39;mint&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>order</h5>

<p>Use <code>order</code> if your association is defined with a scope that sets the
<code>order</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:shirts</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:shirts</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:shirts</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>class_name</h5>

<p>Use <code>class_name</code> to test usage of the <code>:class_name</code> option. This
asserts that the model you&#39;re referring to actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:hopes</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s1">&#39;Dream&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:hopes</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;Dream&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:hopes</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;Dream&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_primary_key</h5>

<p>Use <code>with_primary_key</code> to test usage of the <code>:primary_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:worries</span><span class="p">,</span> <span class="ss">primary_key</span><span class="p">:</span> <span class="s1">&#39;worrier_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:worries</span><span class="p">)</span><span class="o">.</span><span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;worrier_id&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:worries</span><span class="p">)</span><span class="o">.</span><span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;worrier_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_foreign_key</h5>

<p>Use <code>with_foreign_key</code> to test usage of the <code>:foreign_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:worries</span><span class="p">,</span> <span class="ss">foreign_key</span><span class="p">:</span> <span class="s1">&#39;worrier_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:worries</span><span class="p">)</span><span class="o">.</span><span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;worrier_id&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:worries</span><span class="p">)</span><span class="o">.</span><span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;worrier_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>dependent</h5>

<p>Use <code>dependent</code> to assert that the <code>:dependent</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:secret_documents</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:secret_documents</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:destroy</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:secret_documents</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:destroy</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>through</h5>

<p>Use <code>through</code> to test usage of the <code>:through</code> option. This asserts that
the association you are going through actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:acquaintances</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:friends</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:acquaintances</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:acquaintances</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>source</h5>

<p>Use <code>source</code> to test usage of the <code>:source</code> option on a <code>:through</code>
association.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:job_offers</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:friends</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="ss">:opportunities</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:job_offers</span><span class="p">)</span><span class="o">.</span>
      <span class="n">through</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span><span class="o">.</span>
      <span class="n">source</span><span class="p">(</span><span class="ss">:opportunities</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:job_offers</span><span class="p">)</span><span class="o">.</span>
    <span class="n">through</span><span class="p">(</span><span class="ss">:friends</span><span class="p">)</span><span class="o">.</span>
    <span class="n">source</span><span class="p">(</span><span class="ss">:opportunities</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>validate</h5>

<p>Use <code>validate</code> to assert that the <code>:validate</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:ideas</span><span class="p">,</span> <span class="ss">validate</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:ideas</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:ideas</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>autosave</h5>

<p>Use <code>autosave</code> to assert that the <code>:autosave</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Player</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:games</span><span class="p">,</span> <span class="ss">autosave</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Player</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:games</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PlayerTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:games</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>index_errors</h5>

<p>Use <code>index_errors</code> to assert that the <code>:index_errors</code> option was
specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Player</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:games</span><span class="p">,</span> <span class="ss">index_errors</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Player</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:games</span><span class="p">)</span><span class="o">.</span><span class="n">index_errors</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PlayerTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:games</span><span class="p">)</span><span class="o">.</span><span class="n">index_errors</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>inverse_of</h5>

<p>Use <code>inverse_of</code> to assert that the <code>:inverse_of</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Organization</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:employees</span><span class="p">,</span> <span class="ss">inverse_of</span><span class="p">:</span> <span class="ss">:company</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Organization</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:employees</span><span class="p">)</span><span class="o">.</span><span class="n">inverse_of</span><span class="p">(</span><span class="ss">:company</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">OrganizationTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_many</span><span class="p">(</span><span class="ss">:employees</span><span class="p">)</span><span class="o">.</span><span class="n">inverse_of</span><span class="p">(</span><span class="ss">:company</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


595
596
597</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/association_matcher.rb', line 595</span>

<span></span><span class="k">def</span> <span class="nf">have_many</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">AssociationMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:has_many</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_one-instance_method">
  
    #<strong>have_one</strong>(name)  &#x21d2; <tt><span class='object_link'>AssociationMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_one</code> matcher is used to test that a <code>has_one</code> or <code>has_one
:through</code> association exists on your model.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:partner</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>conditions</h5>

<p>Use <code>conditions</code> if your association is defined with a scope that sets
the <code>where</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:pet</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s1">&#39;weight &lt; 80&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:pet</span><span class="p">)</span><span class="o">.</span><span class="n">conditions</span><span class="p">(</span><span class="s1">&#39;weight &lt; 80&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:pet</span><span class="p">)</span><span class="o">.</span><span class="n">conditions</span><span class="p">(</span><span class="s1">&#39;weight &lt; 80&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>order</h5>

<p>Use <code>order</code> if your association is defined with a scope that sets the
<code>order</code> clause.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:focus</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;priority desc&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:focus</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;priority desc&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:focus</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;priority desc&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>class_name</h5>

<p>Use <code>class_name</code> to test usage of the <code>:class_name</code> option. This
asserts that the model you&#39;re referring to actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:chance</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s1">&#39;Opportunity&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:chance</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;Opportunity&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:chance</span><span class="p">)</span><span class="o">.</span><span class="n">class_name</span><span class="p">(</span><span class="s1">&#39;Opportunity&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>dependent</h5>

<p>Use <code>dependent</code> to test that the <code>:dependent</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:contract</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:nullify</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:contract</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:nullify</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:contract</span><span class="p">)</span><span class="o">.</span><span class="n">dependent</span><span class="p">(</span><span class="ss">:nullify</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_primary_key</h5>

<p>Use <code>with_primary_key</code> to test usage of the <code>:primary_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:job</span><span class="p">,</span> <span class="ss">primary_key</span><span class="p">:</span> <span class="s1">&#39;worker_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:job</span><span class="p">)</span><span class="o">.</span><span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;worker_id&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:job</span><span class="p">)</span><span class="o">.</span><span class="n">with_primary_key</span><span class="p">(</span><span class="s1">&#39;worker_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_foreign_key</h5>

<p>Use <code>with_foreign_key</code> to test usage of the <code>:foreign_key</code> option.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:job</span><span class="p">,</span> <span class="ss">foreign_key</span><span class="p">:</span> <span class="s1">&#39;worker_id&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:job</span><span class="p">)</span><span class="o">.</span><span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;worker_id&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:job</span><span class="p">)</span><span class="o">.</span><span class="n">with_foreign_key</span><span class="p">(</span><span class="s1">&#39;worker_id&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>through</h5>

<p>Use <code>through</code> to test usage of the <code>:through</code> option. This asserts that
the association you are going through actually exists.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:life</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:partner</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:life</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:life</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>source</h5>

<p>Use <code>source</code> to test usage of the <code>:source</code> option on a <code>:through</code>
association.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:car</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:partner</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="ss">:vehicle</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:car</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span><span class="o">.</span><span class="n">source</span><span class="p">(</span><span class="ss">:vehicle</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:car</span><span class="p">)</span><span class="o">.</span><span class="n">through</span><span class="p">(</span><span class="ss">:partner</span><span class="p">)</span><span class="o">.</span><span class="n">source</span><span class="p">(</span><span class="ss">:vehicle</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>validate</h5>

<p>Use <code>validate</code> to assert that the the <code>:validate</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:parking_card</span><span class="p">,</span> <span class="ss">validate</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Person</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:parking_card</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:parking_card</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>autosave</h5>

<p>Use <code>autosave</code> to assert that the <code>:autosave</code> option was specified.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:bank</span><span class="p">,</span> <span class="ss">autosave</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Account</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:bank</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">AccountTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:bank</span><span class="p">)</span><span class="o">.</span><span class="n">autosave</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>required</h5>

<p>Use <code>required</code> to assert that the association is not allowed to be nil.
(Rails 5+ only.)</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_one</span> <span class="ss">:brain</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="n">describe</span> <span class="no">Person</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:brain</span><span class="p">)</span><span class="o">.</span><span class="n">required</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_one</span><span class="p">(</span><span class="ss">:brain</span><span class="p">)</span><span class="o">.</span><span class="n">required</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


824
825
826</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/association_matcher.rb', line 824</span>

<span></span><span class="k">def</span> <span class="nf">have_one</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">AssociationMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:has_one</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_readonly_attribute-instance_method">
  
    #<strong>have_readonly_attribute</strong>(value)  &#x21d2; <tt><span class='object_link'>HaveReadonlyAttributeMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>have_readonly_attribute</code> matcher tests usage of the
<code>attr_readonly</code> macro.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">attr_readonly</span> <span class="ss">:password</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_readonly_attribute</span><span class="p">(</span><span class="ss">:password</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">have_readonly_attribute</span><span class="p">(</span><span class="ss">:password</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


23
24
25</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/have_readonly_attribute_matcher.rb', line 23</span>

<span></span><span class="k">def</span> <span class="nf">have_readonly_attribute</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="no">HaveReadonlyAttributeMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="have_secure_token-instance_method">
  
    #<strong>have_secure_token</strong>(token_attribute = :token)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>rubocop:disable Style/PredicateName</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


33
34
35</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/have_secure_token_matcher.rb', line 33</span>

<span></span><span class="k">def</span> <span class="nf">have_secure_token</span><span class="p">(</span><span class="n">token_attribute</span> <span class="o">=</span> <span class="ss">:token</span><span class="p">)</span>
  <span class="no">HaveSecureTokenMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">token_attribute</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="serialize-instance_method">
  
    #<strong>serialize</strong>(name)  &#x21d2; <tt><span class='object_link'>SerializeMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>serialize</code> matcher tests usage of the <code>serialize</code> macro.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">serialize</span> <span class="ss">:customizations</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Product</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:customizations</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProductTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:customizations</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<h5>as</h5>

<p>Use <code>as</code> if you are using a custom serializer class.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">ProductSpecsSerializer</span>
  <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">serialize</span> <span class="ss">:specifications</span><span class="p">,</span> <span class="no">ProductSpecsSerializer</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Product</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:specifications</span><span class="p">)</span><span class="o">.</span>
      <span class="n">as</span><span class="p">(</span><span class="no">ProductSpecsSerializer</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProductTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:specifications</span><span class="p">)</span><span class="o">.</span>
    <span class="n">as</span><span class="p">(</span><span class="no">ProductSpecsSerializer</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>as_instance_of</h5>

<p>Use <code>as_instance_of</code> if you are using a custom serializer object.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">ProductOptionsSerializer</span>
  <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">serialize</span> <span class="ss">:options</span><span class="p">,</span> <span class="no">ProductOptionsSerializer</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Product</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:options</span><span class="p">)</span><span class="o">.</span>
      <span class="n">as_instance_of</span><span class="p">(</span><span class="no">ProductOptionsSerializer</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">ProductTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">serialize</span><span class="p">(</span><span class="ss">:options</span><span class="p">)</span><span class="o">.</span>
    <span class="n">as_instance_of</span><span class="p">(</span><span class="no">ProductOptionsSerializer</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


88
89
90</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/serialize_matcher.rb', line 88</span>

<span></span><span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="no">SerializeMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_uniqueness_of-instance_method">
  
    #<strong>validate_uniqueness_of</strong>(attr)  &#x21d2; <tt><span class='object_link'>ValidateUniquenessOfMatcher</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The <code>validate_uniqueness_of</code> matcher tests usage of the
<code>validates_uniqueness_of</code> validation. It first checks for an existing
instance of your model in the database, creating one if necessary. It
then takes a new instance of that model and asserts that it fails
validation if the attribute or attributes you&#39;ve specified in the
validation are set to values which are the same as those of the
pre-existing record (thereby failing the uniqueness check).</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:permalink</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:permalink</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:permalink</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h4>Caveat</h4>

<p>This matcher works a bit differently than other matchers. As noted
before, it will create an instance of your model if one doesn&#39;t already
exist. Sometimes this step fails, especially if you have database-level
restrictions on any attributes other than the one which is unique. In
this case, the solution is to populate these attributes with values
before you call <code>validate_uniqueness_of</code>.</p>

<p>For example, say you have the following migration and model:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:posts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre>

<p>You may be tempted to test the model like this:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>However, running this test will fail with an exception such as:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="no">Shoulda</span><span class="o">::</span><span class="no">Matchers</span><span class="o">::</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">ValidateUniquenessOfMatcher</span><span class="o">::</span><span class="ss">ExistingRecordInvalid</span><span class="p">:</span>
  <span class="n">validate_uniqueness_of</span> <span class="n">works</span> <span class="n">by</span> <span class="n">matching</span> <span class="n">a</span> <span class="kp">new</span> <span class="n">record</span> <span class="n">against</span> <span class="n">an</span>
  <span class="n">existing</span> <span class="n">record</span><span class="o">.</span> <span class="no">If</span> <span class="n">there</span> <span class="n">is</span> <span class="n">no</span> <span class="n">existing</span> <span class="n">record</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">create</span> <span class="n">one</span>
  <span class="n">using</span> <span class="n">the</span> <span class="n">record</span> <span class="n">you</span> <span class="n">provide</span><span class="o">.</span>

  <span class="no">While</span> <span class="n">doing</span> <span class="n">this</span><span class="p">,</span> <span class="n">the</span> <span class="n">following</span> <span class="n">error</span> <span class="n">was</span> <span class="ss">raised</span><span class="p">:</span>

    <span class="no">PG</span><span class="o">::</span><span class="ss">NotNullViolation</span><span class="p">:</span> <span class="ss">ERROR</span><span class="p">:</span>  <span class="n">null</span> <span class="n">value</span> <span class="k">in</span> <span class="n">column</span> <span class="s2">&quot;content&quot;</span> <span class="n">violates</span> <span class="ow">not</span><span class="o">-</span><span class="n">null</span> <span class="n">constraint</span>
    <span class="ss">DETAIL</span><span class="p">:</span>  <span class="no">Failing</span> <span class="n">row</span> <span class="n">contains</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">null</span><span class="p">)</span><span class="o">.</span>
    <span class="p">:</span> <span class="no">INSERT</span> <span class="no">INTO</span> <span class="s2">&quot;posts&quot;</span> <span class="no">DEFAULT</span> <span class="no">VALUES</span> <span class="no">RETURNING</span> <span class="s2">&quot;id&quot;</span>

  <span class="no">The</span> <span class="n">best</span> <span class="n">way</span> <span class="n">to</span> <span class="n">fix</span> <span class="n">this</span> <span class="n">is</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">matcher</span> <span class="n">with</span> <span class="n">a</span> <span class="n">record</span> <span class="n">where</span>
  <span class="n">any</span> <span class="n">required</span> <span class="n">attributes</span> <span class="n">are</span> <span class="n">filled</span> <span class="k">in</span> <span class="n">with</span> <span class="n">valid</span> <span class="n">values</span> <span class="n">beforehand</span><span class="o">.</span>
</code></pre>

<p>(The exact error message will differ depending on which database you&#39;re
using, but you get the idea.)</p>

<p>This happens because <code>validate_uniqueness_of</code> tries to create a new post
but cannot do so because of the <code>content</code> attribute: though unrelated to
this test, it nevertheless needs to be filled in. As indicated at the
end of the error message, the solution is to build a custom Post object
ahead of time with <code>content</code> filled in:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">&quot;validations&quot;</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="no">Post</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">&quot;Here is the content&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Or, if you&#39;re using
<a href="https://github.com/thoughtbot/factory_bot">FactoryBot</a> and you have a
<code>post</code> factory defined which automatically fills in <code>content</code>, you can
say:</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">&quot;validations&quot;</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h4>Qualifiers</h4>

<p>Use <code>on</code> if your validation applies only under a certain context.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">on</span><span class="p">:</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>with_message</h5>

<p>Use <code>with_message</code> if you are using a custom validation message.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;Please choose another title&#39;</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span>
      <span class="n">with_message</span><span class="p">(</span><span class="s1">&#39;Please choose another title&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span>
    <span class="n">with_message</span><span class="p">(</span><span class="s1">&#39;Please choose another title&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>scoped_to</h5>

<p>Use <code>scoped_to</code> to test usage of the <code>:scope</code> option. This asserts that
a new record fails validation if not only the primary attribute is not
unique, but the scoped attributes are not unique either.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:slug</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">scope</span><span class="p">:</span> <span class="ss">:journal_id</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:slug</span><span class="p">)</span><span class="o">.</span><span class="n">scoped_to</span><span class="p">(</span><span class="ss">:journal_id</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:slug</span><span class="p">)</span><span class="o">.</span><span class="n">scoped_to</span><span class="p">(</span><span class="ss">:journal_id</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<h5>case_insensitive</h5>

<p>Use <code>case_insensitive</code> to test usage of the <code>:case_sensitive</code> option
with a false value. This asserts that the uniquable attributes fail
validation even if their values are a different case than corresponding
attributes in the pre-existing record.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:key</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:key</span><span class="p">)</span><span class="o">.</span><span class="n">case_insensitive</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:key</span><span class="p">)</span><span class="o">.</span><span class="n">case_insensitive</span>
<span class="k">end</span>
</code></pre>

<h5>ignoring_case_sensitivity</h5>

<p>By default, <code>validate_uniqueness_of</code> will check that the
validation is case sensitive: it asserts that uniquable attributes pass
validation when their values are in a different case than corresponding
attributes in the pre-existing record.</p>

<p>Use <code>ignoring_case_sensitivity</code> to skip this check. This qualifier is
particularly handy if your model has somehow changed the behavior of
attribute you&#39;re testing so that it modifies the case of incoming values
as they are set. For instance, perhaps you&#39;ve overridden the writer
method or added a <code>before_validation</code> callback to normalize the
attribute.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>

  <span class="k">def</span> <span class="nf">email</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="k">do</span>
    <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span><span class="o">.</span><span class="n">ignoring_case_sensitivity</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span><span class="o">.</span><span class="n">ignoring_case_sensitivity</span>
<span class="k">end</span>
</code></pre>

<h5>allow_nil</h5>

<p>Use <code>allow_nil</code> to assert that the attribute allows nil.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:author_id</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">allow_nil</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:author_id</span><span class="p">)</span><span class="o">.</span><span class="n">allow_nil</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:author_id</span><span class="p">)</span><span class="o">.</span><span class="n">allow_nil</span>
<span class="k">end</span>
</code></pre>

<h5>allow_blank</h5>

<p>Use <code>allow_blank</code> to assert that the attribute allows a blank value.</p>

<pre class="code ruby"><code class="ruby"><span></span><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:author_id</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">allow_blank</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># RSpec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Post</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:author_id</span><span class="p">)</span><span class="o">.</span><span class="n">allow_blank</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Minitest (Shoulda)</span>
<span class="k">class</span> <span class="nc">PostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">should</span> <span class="n">validate_uniqueness_of</span><span class="p">(</span><span class="ss">:author_id</span><span class="p">)</span><span class="o">.</span><span class="n">allow_blank</span>
<span class="k">end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td class="lines">
      <pre>


255
256
257</pre>
    </td>
    <td class="code">
      <pre><span class="info file"># File 'lib/shoulda/matchers/active_record/validate_uniqueness_of_matcher.rb', line 255</span>

<span></span><span class="k">def</span> <span class="nf">validate_uniqueness_of</span><span class="p">(</span><span class="kp">attr</span><span class="p">)</span>
  <span class="no">ValidateUniquenessOfMatcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="kp">attr</span><span class="p">)</span>
<span class="k">end</span>
</pre>
    </td>
  </tr>
</table>

</div>
    
  </div>

</div>

      <div id="footer">
  Generated on
  July 15, 2019
  by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">YARD</a>.
</div>

    </div>

  </body>
</html>
